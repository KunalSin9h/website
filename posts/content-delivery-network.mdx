---
title: Create a custom CDN - Content Delivery Network
description: Using Pulumi, Nginx and geoDNS created a distributed server network for content delivery.
published: "2024-06-24"
---

### Using Pulumi, Azure, Nginx and geoDNS created a distributed server network for content delivery.
Although this architecture can be used for creating anything which need to be deployed as **\`per user location\`** basis.

For example

- Content Delivery Network
- Distributed  HTTPS Cache
- Distributed Deployments
- And so on...

#### In this very blog, we are just going to see CDN

**CDN** - _Content Delivery Network_

<BlogImage
    src="https://i.imgur.com/cz0tTsI.png"
    alt="cdn example"
    width={1478}
    height={792}
 />

CDN are server used for delivering content - images, videos, audios, texts and blog for naming few. These are located 
on every location where there is significant human population is present.

In the example image above, I have shown how can Company (or even we) place server at different location and create a logic to 
distribute request depending on client location to nearest server.

<BlogImage
    alt="nearest server example"
    src="https://i.imgur.com/r5yYY0B.png"
    width={432}
    height={306}
/>

#### What logic ?

It can be `geoDNS`, `geoDistance`, `Weighted Shuffle` and `Anycast`.

> Go and read about them, Here is TL;DR

- *geoDNS* : Every server has unique **IP**, we distribute request on the basis os IP, ASN, Region, Continent, Country. 

    <details>
    <summary>See example image</summary>

        <BlogImage 
            src="https://i.imgur.com/Zt22jto.png"
            alt="GeoDNS example"
            width={1100}
            height={753}
        />

    </details>

- *geoDistance* : Every server has unique **IP**, we distribute request on the basis nearest server, by calculating shortest distance. 

- *Weighted Shuffle* : Random order with weights - Mainly for preventing DDoS 

- *Anycast*: All the server has same **IP**, request goes to nearest server using *BGP* Protocol. 

    <details>
    <summary>See example image</summary>

        <BlogImage 
            src="https://i.imgur.com/cigYslY.png"
            alt="Anycast example"
            width={1100}
            height={753}
        />

    </details>

> Here *we* means the *DNS* Server.

_Anycast_ is hard to achieve, since involve working with hardware and network layer and publishing same IP for all server.  _Weighed Shuffle_ is not want we want. 
So we are going to use _geoDNS_ and _geoDistance_.

That was a brief about CDNs, now lets talk about creating one. 

# Creating a Custom CDN Network. 

We are gonna use ...

> If you don't want to do these steps exactly simmilar, then you can do it your way. The core
> idea same.

1. Azure for creating Virtual Machines at 5 different locations

    To do this, we are using [Pulumi](https://www.pulumi.com/) - An _Infrastructure as Code_ platform 

2. [Gcore](https://www.pulumi.com/) for DNS with Free geoDNS service. 

    Other DNS service providers, like Cloudflare does not have geoDNS for Free - Its only for Enterprise users.

3. Nginx for _Static contents serving_
    
    To do this, we are using [Ansible](https://www.ansible.com/)

4. Finally upload _Contents_ to our _Content Delivery Network_

    Using _Bash Scripts_ or a custom CLI tool.

## Creating Virtual Machines - Our Servers

The task is to create multiple server (virtual machine) at different locations, and get unique *IP Address* of all.

I'm going to create 5 servers at these locations:

-   "Central US"
-   "Central India"
-   "West Europe"
-   "UAE Central"
-   "Australia Central"

<br />
<details>
    <summary>See how to do it with **Pulumi**</summary>
</details>

After creating these